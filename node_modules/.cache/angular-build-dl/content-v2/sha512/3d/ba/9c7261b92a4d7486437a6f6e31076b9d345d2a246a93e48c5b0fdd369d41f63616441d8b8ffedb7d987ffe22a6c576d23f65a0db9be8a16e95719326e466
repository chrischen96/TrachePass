(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{fQm2:function(e,t,o){"use strict";o.r(t),o.d(t,"PhotoRecordPageModule",function(){return P});var i=o("ofXK"),n=o("3Pt+"),r=o("TEn/"),s=o("tyNb"),l=o("mrSG"),c=o("6g0+"),a=o("fXoL"),d=o("gcOT");const{Camera:h,Filesystem:b,Storage:f}=d.e;let u=(()=>{class e{constructor(e){this.photos=[],this.PHOTO_STORAGE="photos",this.convertBlobToBase64=e=>new Promise((t,o)=>{const i=new FileReader;i.onerror=o,i.onload=()=>{t(i.result)},i.readAsDataURL(e)}),this.platform=e}loadSaved(){return Object(l.a)(this,void 0,void 0,function*(){const e=yield f.get({key:this.PHOTO_STORAGE});if(this.photos=JSON.parse(e.value)||[],!this.platform.is("hybrid"))for(let t of this.photos){const e=yield b.readFile({path:t.filepath,directory:d.d.Data});t.webviewPath="data:image/jpeg;base64,"+e.data}})}reset(){for(let e of this.photos)b.deleteFile({path:e.filepath,directory:d.d.Data});this.photos.splice(0,this.photos.length),f.set({key:this.PHOTO_STORAGE,value:JSON.stringify(this.photos)}),console.log(this.photos),console.log("done deleting all")}removePhoto(e){console.log("before"),console.log(this.photos),b.deleteFile({path:this.photos[e].filepath,directory:d.d.Data}),console.log("deleted"),console.log(this.photos[e].filepath),console.log("editing array"),this.photos.splice(e,1),f.set({key:this.PHOTO_STORAGE,value:JSON.stringify(this.photos)}),console.log("after"),console.log(this.photos)}addNewToGallery(){return Object(l.a)(this,void 0,void 0,function*(){const e=yield h.getPhoto({resultType:d.a.Uri,source:d.b.Camera,quality:100}),t=yield this.savePicture(e);this.photos.unshift(t),console.log("New Phoo array"),console.log(JSON.stringify(this.photos)),f.set({key:this.PHOTO_STORAGE,value:JSON.stringify(this.photos)})})}savePicture(e){return Object(l.a)(this,void 0,void 0,function*(){const t=yield this.readAsBase64(e),o=(new Date).getTime()+".jpeg",i=yield b.writeFile({path:o,data:t,directory:d.d.Data});return this.platform.is("hybrid")?{filepath:i.uri,webviewPath:d.c.convertFileSrc(i.uri)}:{filepath:o,webviewPath:e.webPath}})}readAsBase64(e){return Object(l.a)(this,void 0,void 0,function*(){if(this.platform.is("hybrid"))return(yield b.readFile({path:e.path})).data;{const t=yield fetch(e.webPath),o=yield t.blob();return yield this.convertBlobToBase64(o)}})}}return e.\u0275fac=function(t){return new(t||e)(a.Rb(r.R))},e.\u0275prov=a.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var p=o("EFyh");function m(e,t){if(1&e){const e=a.Ob();a.Nb(0,"ion-button",9),a.Vb("click",function(){return a.hc(e),a.Xb().changeMode()}),a.mc(1," Edit "),a.Mb()}}function g(e,t){if(1&e){const e=a.Ob();a.Nb(0,"ion-button",10),a.Vb("click",function(){return a.hc(e),a.Xb().changeMode()}),a.mc(1," Done "),a.Mb()}}function y(e,t){if(1&e){const e=a.Ob();a.Nb(0,"ion-col",11),a.Nb(1,"ion-img",12),a.Vb("click",function(){a.hc(e);const o=t.index,i=t.$implicit,n=a.Xb();return n.editmode?n.alertDeleteConfirm(o):n.openViewer(i.webviewPath)}),a.Mb(),a.Mb()}if(2&e){const e=t.$implicit;a.xb(1),a.dc("src",e.webviewPath)}}function v(e,t){if(1&e){const e=a.Ob();a.Nb(0,"ion-fab",13),a.Nb(1,"ion-fab-button",9),a.Vb("click",function(){return a.hc(e),a.Xb().addPhotoToGallery()}),a.Jb(2,"ion-icon",14),a.Mb(),a.Mb()}}const w=[{path:"",component:(()=>{class e{constructor(e,t,o,i){this.photoService=e,this.alertController=t,this.modalController=o,this.loginService=i,this.editmode=!1}ngOnInit(){return Object(l.a)(this,void 0,void 0,function*(){yield this.photoService.loadSaved()})}changeMode(){this.editmode=!1===this.editmode,console.log(this.editmode)}addPhotoToGallery(){return Object(l.a)(this,void 0,void 0,function*(){yield this.photoService.addNewToGallery()})}resetGallery(){this.photoService.reset()}removePhotoFromGallery(e){console.log(e),this.photoService.removePhoto(e)}alertDeleteConfirm(e){return Object(l.a)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"Confirm Delete",message:"The selected photo will be <strong>Deleted</strong>!",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:e=>{console.log("Confirm Cancel: blah")}},{text:"Delete",cssClass:"alert",handler:t=>{this.removePhotoFromGallery(e)}}]});yield t.present()})}alertResetConfirm(e){return Object(l.a)(this,void 0,void 0,function*(){const e=yield this.alertController.create({header:"Confirm Delete",message:"The Photo Record will be <strong>Resetted</strong>!",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:e=>{console.log("Confirm Cancel: blah")}},{text:"Delete",handler:e=>{this.resetGallery()}}]});yield e.present()})}openViewer(e){return Object(l.a)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:c.b,componentProps:{src:e},cssClass:"ion-img-viewer",keyboardClose:!0,showBackdrop:!0});yield t.present()})}}return e.\u0275fac=function(t){return new(t||e)(a.Ib(u),a.Ib(r.b),a.Ib(r.P),a.Ib(p.a))},e.\u0275cmp=a.Cb({type:e,selectors:[["app-photo-record"]],decls:14,vars:5,consts:[[3,"translucent"],["slot","start"],["defaultHref","/medical-record"],["slot","end"],[3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["overflow-scroll","true"],["size","6",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","center","slot","fixed","style","margin-bottom: 15%;",4,"ngIf"],[3,"click"],["color","danger",3,"click"],["size","6"],[3,"src","click"],["vertical","bottom","horizontal","center","slot","fixed",2,"margin-bottom","15%"],["name","camera"]],template:function(e,t){1&e&&(a.Nb(0,"ion-header",0),a.Nb(1,"ion-toolbar"),a.Nb(2,"ion-buttons",1),a.Jb(3,"ion-back-button",2),a.Mb(),a.Nb(4,"ion-title"),a.mc(5," Photo Record "),a.Mb(),a.Nb(6,"ion-buttons",3),a.lc(7,m,2,0,"ion-button",4),a.lc(8,g,2,0,"ion-button",5),a.Mb(),a.Mb(),a.Mb(),a.Nb(9,"ion-content",6),a.Nb(10,"ion-grid"),a.Nb(11,"ion-row"),a.lc(12,y,2,1,"ion-col",7),a.Mb(),a.Mb(),a.lc(13,v,3,0,"ion-fab",8),a.Mb()),2&e&&(a.dc("translucent",!0),a.xb(7),a.dc("ngIf",!t.editmode),a.xb(1),a.dc("ngIf",t.editmode),a.xb(4),a.dc("ngForOf",t.photoService.photos),a.xb(1),a.dc("ngIf",!t.editmode))},directives:[r.v,r.M,r.h,r.e,r.f,r.K,i.l,r.p,r.u,r.E,i.k,r.g,r.o,r.x,r.r,r.s,r.w],styles:[".alert[_ngcontent-%COMP%]{color:red}"]}),e})()}];let O=(()=>{class e{}return e.\u0275mod=a.Gb({type:e}),e.\u0275inj=a.Fb({factory:function(t){return new(t||e)},imports:[[s.i.forChild(w)],s.i]}),e})(),P=(()=>{class e{}return e.\u0275mod=a.Gb({type:e}),e.\u0275inj=a.Fb({factory:function(t){return new(t||e)},imports:[[i.b,n.d,r.N,O]]}),e})()}}]);