!function(){function e(e,n){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,n){if(!e)return;if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,n)}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw a}}}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{fQm2:function(t,r,i){"use strict";i.r(r),i.d(r,"PhotoRecordPageModule",function(){return M});var a,s=i("ofXK"),c=i("3Pt+"),l=i("TEn/"),u=i("tyNb"),h=i("mrSG"),f=i("6g0+"),d=i("fXoL"),b=i("gcOT"),p=b.e,v=p.Camera,m=p.Filesystem,g=p.Storage,y=((a=function(){function t(e){n(this,t),this.photos=[],this.PHOTO_STORAGE="photos",this.convertBlobToBase64=function(e){return new Promise(function(t,n){var r=new FileReader;r.onerror=n,r.onload=function(){t(r.result)},r.readAsDataURL(e)})},this.platform=e}return o(t,[{key:"loadSaved",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.get({key:this.PHOTO_STORAGE});case 2:if(n=t.sent,this.photos=JSON.parse(n.value)||[],this.platform.is("hybrid")){t.next=23;break}r=e(this.photos),t.prev=5,r.s();case 7:if((o=r.n()).done){t.next=15;break}return i=o.value,t.next=11,m.readFile({path:i.filepath,directory:b.d.Data});case 11:a=t.sent,i.webviewPath="data:image/jpeg;base64,"+a.data;case 13:t.next=7;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),r.e(t.t0);case 20:return t.prev=20,r.f(),t.finish(20);case 23:case"end":return t.stop()}},t,this,[[5,17,20,23]])}))}},{key:"reset",value:function(){var t,n=e(this.photos);try{for(n.s();!(t=n.n()).done;){var r=t.value;m.deleteFile({path:r.filepath,directory:b.d.Data})}}catch(o){n.e(o)}finally{n.f()}this.photos.splice(0,this.photos.length),g.set({key:this.PHOTO_STORAGE,value:JSON.stringify(this.photos)}),console.log(this.photos),console.log("done deleting all")}},{key:"removePhoto",value:function(e){console.log("before"),console.log(this.photos),m.deleteFile({path:this.photos[e].filepath,directory:b.d.Data}),console.log("deleted"),console.log(this.photos[e].filepath),console.log("editing array"),this.photos.splice(e,1),g.set({key:this.PHOTO_STORAGE,value:JSON.stringify(this.photos)}),console.log("after"),console.log(this.photos)}},{key:"addNewToGallery",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getPhoto({resultType:b.a.Uri,source:b.b.Camera,quality:100});case 2:return t=e.sent,e.next=5,this.savePicture(t);case 5:n=e.sent,this.photos.unshift(n),console.log("New Phoo array"),console.log(JSON.stringify(this.photos)),g.set({key:this.PHOTO_STORAGE,value:JSON.stringify(this.photos)});case 7:case"end":return e.stop()}},e,this)}))}},{key:"savePicture",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.readAsBase64(e);case 2:return n=t.sent,r=(new Date).getTime()+".jpeg",t.next=6,m.writeFile({path:r,data:n,directory:b.d.Data});case 6:return o=t.sent,t.abrupt("return",this.platform.is("hybrid")?{filepath:o.uri,webviewPath:b.c.convertFileSrc(o.uri)}:{filepath:r,webviewPath:e.webPath});case 8:case"end":return t.stop()}},t,this)}))}},{key:"readAsBase64",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.platform.is("hybrid")){t.next=4;break}return t.next=3,m.readFile({path:e.path});case 3:return t.abrupt("return",t.sent.data);case 4:return t.next=6,fetch(e.webPath);case 6:return n=t.sent,t.next=9,n.blob();case 9:return r=t.sent,t.next=12,this.convertBlobToBase64(r);case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}},t,this)}))}}]),t}()).\u0275fac=function(e){return new(e||a)(d.Rb(l.R))},a.\u0275prov=d.Eb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),w=i("EFyh");function k(e,t){if(1&e){var n=d.Ob();d.Nb(0,"ion-button",9),d.Vb("click",function(){return d.hc(n),d.Xb().changeMode()}),d.mc(1," Edit "),d.Mb()}}function x(e,t){if(1&e){var n=d.Ob();d.Nb(0,"ion-button",10),d.Vb("click",function(){return d.hc(n),d.Xb().changeMode()}),d.mc(1," Done "),d.Mb()}}function O(e,t){if(1&e){var n=d.Ob();d.Nb(0,"ion-col",11),d.Nb(1,"ion-img",12),d.Vb("click",function(){d.hc(n);var e=t.index,r=t.$implicit,o=d.Xb();return o.editmode?o.alertDeleteConfirm(e):o.openViewer(r.webviewPath)}),d.Mb(),d.Mb()}if(2&e){var r=t.$implicit;d.xb(1),d.dc("src",r.webviewPath)}}function P(e,t){if(1&e){var n=d.Ob();d.Nb(0,"ion-fab",13),d.Nb(1,"ion-fab-button",9),d.Vb("click",function(){return d.hc(n),d.Xb().addPhotoToGallery()}),d.Jb(2,"ion-icon",14),d.Mb(),d.Mb()}}var R,C,S,N=[{path:"",component:(R=function(){function e(t,r,o,i){n(this,e),this.photoService=t,this.alertController=r,this.modalController=o,this.loginService=i,this.editmode=!1}return o(e,[{key:"ngOnInit",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.photoService.loadSaved();case 2:case"end":return e.stop()}},e,this)}))}},{key:"changeMode",value:function(){this.editmode=!1===this.editmode,console.log(this.editmode)}},{key:"addPhotoToGallery",value:function(){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.photoService.addNewToGallery();case 2:case"end":return e.stop()}},e,this)}))}},{key:"resetGallery",value:function(){this.photoService.reset()}},{key:"removePhotoFromGallery",value:function(e){console.log(e),this.photoService.removePhoto(e)}},{key:"alertDeleteConfirm",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({header:"Confirm Delete",message:"The selected photo will be <strong>Deleted</strong>!",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Confirm Cancel: blah")}},{text:"Delete",cssClass:"alert",handler:function(t){r.removePhotoFromGallery(e)}}]});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}},t,this)}))}},{key:"alertResetConfirm",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({header:"Confirm Delete",message:"The Photo Record will be <strong>Resetted</strong>!",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:function(e){console.log("Confirm Cancel: blah")}},{text:"Delete",handler:function(e){n.resetGallery()}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}},e,this)}))}},{key:"openViewer",value:function(e){return Object(h.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.modalController.create({component:f.b,componentProps:{src:e},cssClass:"ion-img-viewer",keyboardClose:!0,showBackdrop:!0});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}},t,this)}))}}]),e}(),R.\u0275fac=function(e){return new(e||R)(d.Ib(y),d.Ib(l.b),d.Ib(l.P),d.Ib(w.a))},R.\u0275cmp=d.Cb({type:R,selectors:[["app-photo-record"]],decls:14,vars:5,consts:[[3,"translucent"],["slot","start"],["defaultHref","/medical-record"],["slot","end"],[3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["overflow-scroll","true"],["size","6",4,"ngFor","ngForOf"],["vertical","bottom","horizontal","center","slot","fixed","style","margin-bottom: 15%;",4,"ngIf"],[3,"click"],["color","danger",3,"click"],["size","6"],[3,"src","click"],["vertical","bottom","horizontal","center","slot","fixed",2,"margin-bottom","15%"],["name","camera"]],template:function(e,t){1&e&&(d.Nb(0,"ion-header",0),d.Nb(1,"ion-toolbar"),d.Nb(2,"ion-buttons",1),d.Jb(3,"ion-back-button",2),d.Mb(),d.Nb(4,"ion-title"),d.mc(5," Photo Record "),d.Mb(),d.Nb(6,"ion-buttons",3),d.lc(7,k,2,0,"ion-button",4),d.lc(8,x,2,0,"ion-button",5),d.Mb(),d.Mb(),d.Mb(),d.Nb(9,"ion-content",6),d.Nb(10,"ion-grid"),d.Nb(11,"ion-row"),d.lc(12,O,2,1,"ion-col",7),d.Mb(),d.Mb(),d.lc(13,P,3,0,"ion-fab",8),d.Mb()),2&e&&(d.dc("translucent",!0),d.xb(7),d.dc("ngIf",!t.editmode),d.xb(1),d.dc("ngIf",t.editmode),d.xb(4),d.dc("ngForOf",t.photoService.photos),d.xb(1),d.dc("ngIf",!t.editmode))},directives:[l.v,l.M,l.h,l.e,l.f,l.K,s.l,l.p,l.u,l.E,s.k,l.g,l.o,l.x,l.r,l.s,l.w],styles:[".alert[_ngcontent-%COMP%]{color:red}"]}),R)}],T=((S=function e(){n(this,e)}).\u0275mod=d.Gb({type:S}),S.\u0275inj=d.Fb({factory:function(e){return new(e||S)},imports:[[u.i.forChild(N)],u.i]}),S),M=((C=function e(){n(this,e)}).\u0275mod=d.Gb({type:C}),C.\u0275inj=d.Fb({factory:function(e){return new(e||C)},imports:[[s.b,c.d,l.N,T]]}),C)}}])}();